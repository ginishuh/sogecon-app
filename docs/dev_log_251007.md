# dev_log_251007

- Start M3 phase-2 branch (subscription auth + tests). Add phase-2 plan doc.
- API: 구독 저장/삭제 엔드포인트를 멤버 세션 가드(require_member)로 전환(임시로 admin 세션을 멤버로 간주).
- Tests: 인증 없음 401, 잘못된 구독 payload 422 추가. 전체 테스트 21개 통과.
- Web: CTA 오류 메시지 개선(권한 거부/로그인 유도).
- Tests: 관리 발송 경로(POST /notifications/admin/notifications/test) 1/min 레이트리밋 429 테스트 추가. 총 22개 통과.
 - 테스트 정리: 429 테스트에서 provider override를 try/finally로 복구, 세션/IP 설정은 httpx.AsyncClient+ASGITransport 사용.
 - Web: CTA는 ApiError.status로 401 감지(문자열 매칭 제거).

- M3-3 시작: 멤버 세션 인증 정식화(임시 admin 호환 유지).
- Member UI 보강: 헤더 역할 배지, 로그인 안내 문구 추가.
- Member UI: 멤버 전용 가드/최근 로그인 방식 저장.
- Web: UI/라우트 가드 추가(RequireAdmin/RequireMember), 관리자 전용 링크 보호.
- Web: admin notifications 페이지 RequireAdmin 가드 추가.
- M3-4 시작: 구독 암호화/정리/지표 중 암호화·지표 1차 반영.
- M3-4: prune-logs 추가, 테스트 통과(23).
- 환경/유틸: 설정 캐시 리셋 유틸 추가(reset_settings_cache), Web Push at-rest 암호화 스모크 테스트 추가.
- 마이그레이션: 0008 endpoint_hash backfill에서 MetaData.bind 제거(pyright 호환).
- 마이그레이션: 0009 endpoint_hash를 NOT NULL로 승격(백필 포함).
- 보안/안정성: decrypt_str가 키 불일치/손상 시 예외 대신 원문 반환으로 안전 실패(크래시 방지). 단위 테스트 추가.
- 의존성: pip-audit 지적(GHSA-79v4-65xg-pq4g) 대응 위해 cryptography 44.0.1로 상향.
- ABC Phase 1 착수: /auth/member/activate, /auth/member/change-password, /support/contact 추가 및 테스트(총 28개 통과). support는 개발 단계에서 파일 로그로 수신.
- Web 스케폴드: /activate, /settings/password, /support/contact, /me, /directory 페이지 골격 추가(폼/토스트 연결). Next build OK.
 - C v0: /members 필터(q/cohort/major) + /directory 목록 연동(react-query). 테스트 29 → 31.
- A-4 보강: /support/contact 입력 검증(min/max), honeypot, 간단 로그 로테이션(1MiB). 레이트리밋 테스트 추가.
- 린트/타입: profile/support/members 경로 정리 및 테스트 보강.
 - 디렉터리 무한스크롤 추가(useInfiniteQuery), A-4에 키워드 스팸 드롭/60초 중복 쿨다운 도입.

- Web: app/icon.svg 추가(Next가 favicon.ico 자동 제공) → 개발 중 404 잡음 제거.
- Web: /directory에 디바운스(400ms)·URL 자동 동기화 적용(과다 refetch/리렌더 방지).
- Docs: PR 템플릿 사용 의무 규칙이 베이스 문서(영/국)와 AGENTS.md에 반영되어 있는지 재확인.

- Web: typedRoutes 활성 환경에서 router.replace 경로를 `Route`로 캐스팅(동적 쿼리 경로만 사용).
- Web: /directory는 useSearchParams 요구에 맞게 Suspense로 감싸 프로덕션 빌드 오류 제거.
- API: support 로그 로테이션에서 광범위 예외 제거 → (OSError, PermissionError)만 포착하고 경고 로깅. Bandit B110 해소.
- Docs: `docs/m3_push_polish_plan_251007.md` 작성, `docs/plan_251007.md`에 링크 추가 및 다음 단계(After Merge Plan) 섹션 갱신.
 - Web: admin notifications에 로그 정리(prune) UI 추가, 로그 표시 개수 선택(20/50/100/200) 지원, 암호화 상태 배지(ON/OFF) 강조.
 - Docs: worklog 갱신 — admin notifications UI 폴리시 반영.
- API: 통계 기간(range=24h/7d/30d) 파라미터 및 실패 코드 분포(404/410/others) 제공.
- Web: 기간 필터 드롭다운/요약 새로고침 버튼 추가, 실패 분포 표시. prune 응답에 기준시각(before) 표시.
- Ops: re-key 스크립트(`ops/rekey_push_kek.py`) 추가 — KEK 로테이션 절차 문서(security_hardening.md)와 연동. ruff/pyright 통과.
- API(B v1): /me 프로필 확장(회사/부서/직급/회사전화/개인·직장주소/업종), update_member_profile 복잡도 축소(model_dump).
- C v0: 수첩 필터 확장(industry/company/region) — 목록/카운트 필터, /directory UI 입력·URL 동기화. 테스트 37 통과.
- D 초안: posts에 category/pinned/cover_image 도입, 목록 category 필터 + pinned 우선 정렬. 테스트 38 통과.
- Web: 게시글 작성 폼에 category/pinned/cover_image 입력 연결.
- Web: 고정 공지 섹션 분리(splitPinned), pinned 3개 제한·공지 더보기 버튼, next/image remotePatterns(`NEXT_PUBLIC_IMAGE_DOMAINS`) 구성, /posts/[id] 상세 UI 추가.
- Web: vitest 3.2.4 업그레이드(GHSA-9crc-q9x8-hgqq 대응).
- DB: Alembic 0012_member_post_extra_fields 추가(Member 회사/업종/주소 + Post category/pinned/cover 컬럼 생성).
