# Worklog

## 2025-10-05
- 타입 명세 강화: 서비스/리포지토리 payload에 Pydantic 스키마 타입 적용(pyright strict 통과), SQLAlchemy Enum 속성은 `setattr`로 할당
- `events_service.upsert_rsvp_status`에서 `RSVPCreate` 인스턴스 생성해 레포 호출(딕셔너리 전달 제거)
- RSVP 상태 타입을 `schemas.RSVPLiteral`로 명시(events_service)해 pyright 엄격 모드 오류 제거
- 전역 예외 핸들러 추가: 도메인 예외(NotFound/AlreadyExists/Conflict) → HTTP 상태(404/409)로 매핑, 라우터의 try/except 제거
- 정적 분석 정리: 전역 예외 핸들러 참조를 유지해 pyright의 unused 경고 해소
- API 계층화 적용: Routers → Services → Repositories 구조 스캐폴드(`apps/api/services/*`, `apps/api/repositories/*`, `apps/api/errors.py`) 추가 및 기존 라우터 전면 위임으로 리팩터링
- Web 데이터 계층 도입: 공용 API 클라이언트(`apps/web/lib/api.ts`)와 도메인 서비스(`apps/web/services/posts.ts`, `apps/web/services/events.ts`) 추가, 페이지에서 직접 fetch 제거
- `docs/architecture.md`를 SSOT 규칙에 맞춰 레이어드 아키텍처 강제 문구로 갱신
- 모바일 웹 우선 원칙과 PWA/Web Push 지원을 아키텍처에 반영, SMS 채널 보류 명시 및 세부 가이드(`docs/pwa_push.md`) 추가
- 에이전트 베이스 문서 추가(`docs/agents_base.md`, `docs/agents_base_kr.md`) 및 AGENTS/CLAUDE/Copilot 문서 동기화
- 품질 가드 도입: 우회 주석 금지/파일 600줄 제한/복잡도 가드 스크립트(`ops/ci/guards.py`), Ruff/Pyright/ESLint 설정 강화
- CI에 레포 가드 잡 추가, 프리커밋 훅에 레포 가드 실행 포함
- API 레이트리밋 도입(`slowapi==0.1.9`), 기본 per-IP 120/minute. FastAPI 미들웨어와 예외 핸들러 연결
- pre-push 훅이 활성 venv 우선으로 `pyright` 실행 후, 테스트 존재 시 `pytest -q`까지 수행하도록 강화
- commit-msg 훅 실행 권한 추가 및 Conventional Commits 규칙 적용 확인
- pyright 오류 수정: SecurityHeadersMiddleware.dispatch 타입 보강 및 레이트리밋 예외 핸들러 래퍼; 마이그레이션 폴더는 pyright 제외
- pre-push 훅: 테스트 파일 탐색 로직 수정(매치 없을 때 pytest 미실행)
- repo-guards: 빌드 산출물 `.next` 디렉터리 제외(@ts-ignore false positive 방지)
- pre-push 훅에서 웹 빌드 제거(CI에서만 실행). 과도기 플래그는 폐기
- 웹: Tailwind v3.4.13로 다운그레이드(안정화), PostCSS 설정 복원(tailwindcss 플러그인)
- CI: gitleaks 액션 입력 경고 제거(args 제거) 및 shallow fetch 문제 해결(fetch-depth: 0)
- CI: Corepack으로 pnpm 버전 고정(10.17.1) — repo-guards/web 잡 모두 적용
- CI 트리거를 PR 전용으로 전환(push:main 제거), concurrency로 중복 실행 방지
- 루트 package.json은 제거(불필요). pnpm pin은 apps/web/package.json + CI Corepack으로 유지
- API: ruff 오류 정리(E501/I001/UP*), FastAPI 관례(B008)는 ruff 설정에서 예외 처리
- SQLAlchemy: 타입체커 호환을 위해 setattr 패턴 유지, ruff에서 B010 예외 처리
- 에이전트 베이스: 언어/커뮤니케이션 규칙을 영문/국문 베이스 문서에 명시(코드 주석/문서/커밋/PR은 한국어 기본)
- 에이전트 가이드 정리: 베이스(`docs/agents_base*.md`)의 SSOT 섹션 제거, `AGENTS.md`/`CLAUDE.md`/`copilot-instructions.md`에 비‑SSOT 배너만 유지
- 에이전트 문서 동기화: `AGENTS.md`/`CLAUDE.md`/`copilot-instructions.md`에 Agents Base(영문) 전체 본문을 'verbatim copy'로 포함하여 각 문서 단독으로 완결성 확보
 - 한글 베이스 동기화: `docs/agents_base_kr.md`에 동일 SSOT 섹션을 추가(영문 베이스와 의미 동등)

## 2025-09-28
- .gitignore에 mypy/ruff 캐시 폴더를 추가해 불필요한 상태 변화를 제거
- AGENTS.md 본문을 영어로 통일하면서 한국어 우선 커뮤니케이션 규칙을 유지
- 프로젝트 스캐폴드 구성 완료 (API, Web, Schemas, Infra, Ops)
- 프리커밋/프리푸시 훅 및 CI 구성 초안 마련
- pyright 타입 검사를 .venv 기반 dev requirements에 통합하고 프리커밋/CI와 연동
- 훅 중복 검사를 줄이기 위해 pre-commit/CI 책임을 분리하고 pre-push에서 pyright만 실행하도록 조정
- AGENTS.md를 최신 가이드(훅 역할 분리, Draft PR 정책 등)로 갱신
- pytest를 dev requirements에 추가하고 문서/가이드에 테스트 실행 방법을 반영
- FastAPI 라우터 반환 값을 Pydantic으로 검증해 pyright 오류를 제거하고 enum 캐스팅을 보완
- pyright 경고를 해소하기 위해 RSVP 상태 설정 방식을 조정하고 config에 루트 경로를 추가
- 프리푸시 훅이 API 건강 체크 후 스키마 생성을 수행하도록 개선
- Next.js 빌드가 권장하는 tsconfig/next-env 업데이트를 반영해 반복 diff를 방지
- 홈 화면에서 실시간 fetch 대신 안내 문구로 헬스 체크 정보를 전달하도록 단순화
- README 상단에 영어 요약 및 quickstart를 병기해 국제 협업 대비
- `.github/copilot-instructions.md`를 추가하여 AI 코딩 에이전트용 가이드를 정리
- `docs/architecture.md`를 신설하고 에이전트 지침 문서에 교차 링크를 추가
