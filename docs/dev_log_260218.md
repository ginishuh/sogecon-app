# 2026-02-18

- Added: `apps/api/reset_data.py` 원타임 데이터 리셋 커맨드 추가 (`ALLOW_DESTRUCTIVE_RESET=1` 가드)
- Added: 회원 전환 대상 테이블 삭제 순서 및 스키마 미존재(`signup_requests`) 자동 스킵 처리
- Added: `tests/api/test_reset_data.py` 가드 검증/선별 삭제/로그 보존 테스트 추가
- Ops: `Makefile`에 `reset-data` 타깃 추가
- Docs: `docs/issue113_data_reset_runbook.md` 실행 절차/주의사항 문서화
- Docs: `docs/worklog.md` 삭제 및 정책을 commit/PR + `docs/dev_log_YYMMDD.md` 중심으로 전환
- Fixed: PR 리뷰 반영 — `admin_users`를 리셋 대상에 추가하고 `events`/`hero_items` 보존 의도 및 범위를 런북에 명시
- Fixed: 리셋 SQL 생성부 화이트리스트 검증 추가 및 테스트 보강(admin 삭제/콘텐츠 보존 검증)
- Ops: `pre-push`에 Python 변경 시 Bandit 보안 스캔 추가, `requirements-dev`에 `bandit` 핀 추가
- Feat: #115 착수 — `members.status`/`signup_requests` 모델·마이그레이션 추가, 시드를 관리자 bootstrap 전용으로 재구성
- Fixed: PR #121 리뷰 반영 — `MemberCreate`에 `status` 노출 제거, `seed-admin` alias 중복 정의 정리
- Chore: PR #121 CI(verify-dto) 대응으로 `packages/schemas/openapi.json`, `packages/schemas/index.d.ts` 재생성 반영
- Feat: #116 착수 — `POST /auth/member/signup`, 관리자 심사 API(`GET/approve/reject /admin/signup-requests`) 및 `admin_signup` 권한 가드 추가
- Feat: `roles_service` 단일 파서 도입 및 `signup_requests`에 `phone`/`note` 컬럼 확장(+ Alembic `b6d2e8f1c4a7`)
- Test: `tests/api/test_signup_requests_api.py` 추가(신청/중복/활성충돌/권한403/승인·반려 플로우 검증)
- Feat: #117 착수 — 활성화 토큰을 `URLSafeTimedSerializer`(72h TTL)로 전환하고 승인 기반 1회성(`activated_at`) 검증 적용
- Feat: `login_member`에 `members.status=active` 게이트 적용, `/auth/session`에 `roles: string[]` 응답 보장
- Feat: 승인 응답에 `activation_token` 포함 및 활성화 성공 시 통합 `user` 세션 설정으로 레거시 세션 버그 제거
- Test: `tests/api/test_abc_phase1.py` 갱신(승인 기반 활성화, 만료/위조/재사용 차단, inactive 로그인 차단)
- Fix: PR #123 리뷰 반영 — 활성화 helper 반환 타입 구체화, 레거시 `/auth/session` roles를 DB 기반으로 정규화
- Notes: 이슈 #114 작업 착수, Epic #113 하위 이슈 순서에 맞춰 진행
