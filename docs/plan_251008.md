# 계획서 — 2025-10-08 (B v2 / C v1 / M4 착수)

## 배경 / SSOT 정합성
- 기준 문서: `docs/Project_overview.md`(IA/목적) · `docs/execution_plan_251006.md`(로드맵) · `docs/plan_251007.md`(직전 사이클)
- 현재: A-2/3/4(활성화/비번변경/문의), B v1(내 정보 1차), C v0(디렉터리 스켈레톤), M3 Push Polish까지 완료.
- 다음 사이클은 B v2(프로필 확장/검증), C v1(디렉터리 UX 고도화), M4(운영화/안정성)로 구성.

## 목표(이번 사이클)
1) B v2 — 프로필 확장/검증 강화 및 UX 보완
2) C v1 — 디렉터리 검색/필터/상태 동기화 및 접근성 개선
3) M4 일부 선행 — DTO 동기화 자동화, PWA/보안·관측 보완의 토대 마련

## 범위(Scope)
### B v2 — 프로필 확장/검증
- 검증 규칙 명시 및 서버/웹 동기화: 전화/회사전화(형식), 주소(길이/허용 문자), 직함/부서(길이), 업종 정규화 목록(선택)
- 공개범위 정책 UI/카피 개선: 항목별 공개/비공개 영향 설명, 접근성 레이블(스크린리더)
- 아바타 업로드(선택): 업로드→리사이즈(최대 512px/100KB 권장), 확장자/콘텐츠 타입 가드, 서버 보관 경로 규칙
- 테스트: 401/403 권한, 422 검증(서버), 클라이언트 폼 검증 스냅샷/상호작용

### C v1 — 디렉터리 UX 고도화
- URL 동기화: 검색어/필터/페이지 상태를 URL 쿼리에 반영하고 공유 가능
- 무한스크롤/페이지네이션 안정화: 로딩/빈 상태/에러 상태 일관화, 스켈레톤 UI
- 카드/목록 정보 구조: 이름/기수/전공/업종 우선, 연락 액션은 공개범위에 따라 노출 제어
- 접근성/디자인: 컬러 대비/포커스 링/키보드 탐색, 반응형 그리드·간격 토큰 정리
- 테스트: 쿼리 파라미터→결과 반영, 필터 조합/페이지네이션, 접근성 속성 존재

### M4(부분 선행) — 운영화/안정성 토대
- DTO 동기화 자동화: `packages/schemas` 생성 타입을 앱 웹에 바인딩(경로/빌드 스크립트 정리)
- PWA 보강: 오프라인 스켈레톤(홈/디렉터리 미니 목록), 설치 가이드/권한 UX 카피 개선
- 보안·관측 준비: CSP 강화 초안, 구조화 로그 키(code/request_id) 일관화 문서, 레이트리밋 정책 분리 초안(로그인/발송/문의)

## 산출물(DoD)
- B v2
  - [x] 서버 검증: 전화/주소/직함/부서/업종 규칙 반영, 실패 시 Problem Details(code 유지) — 2025-10-08 1차 완료(테스트 `tests/api/test_profile_validation_v2.py`)
  - [x] 웹 폼 검증/에러 맵핑, 공개범위 안내 카피/툴팁 — 2025-10-08 `/me` 폼 동기 검증·접근성 레이블·vitest 추가(`apps/web/__tests__/me-form.validation.test.tsx`)
  - [x] 아바타 업로드+리사이즈(선택 기능) 스펙/가드 구현 — 2025-10-08 `/me/avatar` 업로드·100KB/512px 제한·JPEG 리사이즈 + 정적 서빙(`tests/api/test_profile_avatar.py`)
  - [ ] 테스트: API 단위/통합, 웹 상호작용/스냅샷
- C v1
  - [ ] URL 동기화(검색/필터/페이지), 새로고침/공유 시 상태 보존
  - [ ] 무한스크롤+빈/에러/로딩 상태 구성
  - [ ] 접근성 개선(ARIA/포커스 관리)
  - [ ] 테스트: 필터 조합/페이지네이션/접근성 속성
- M4(부분)
  - [ ] DTO 자동 동기화 스크립트 정리 및 앱 연동 가이드
  - [ ] PWA 오프라인 스켈레톤 1차
  - [ ] 보안/관측 초안 문서 갱신(`security_hardening.md`, `architecture.md`)

## 작업 순서(브랜치/PR)
1) feat/b2-profile-validation — 서버/웹 검증, 공개범위 UX, 테스트
2) feat/c1-directory-ux — URL 동기화, 목록/카드 UX/접근성, 테스트
3) chore/dto-sync — DTO 동기화 자동화 및 문서 갱신
4) feat/pwa-offline-skeleton — 홈/디렉터리 오프라인 스켈레톤

## 위험/의존성
- 공개범위/연락처 정책: SSOT 합의 필요(항목별 노출 범위 표)
- 업종/전공 표준화 목록: 사전 목록 합의 또는 자유입력+추천(초기)
- 이미지 업로드: 저장소/용량/보안(Exif 제거) 결정 필요

## 측정/검증
- 테스트 수: 현재 35 → +8 이상(서버 5, 웹 3)
- 빌드/린트/타입 검사 CI 그린
- Lighthouse(접근성/성능) 개선 지표: 접근성 ≥ 90 목표(디렉터리)

## 일정(권고)
- B v2: 1~2일
- C v1: 1~2일
- M4 부분: 1일

## 문서/SSOT 반영
- `docs/architecture.md` 표/플로우 업데이트
- `docs/security_hardening.md`에 검증/업로드/레이트리밋/헤더 강화 내용 추가
- `docs/worklog.md`와 `docs/dev_log_251008.md`에 진행 내역/링크 기록
