# 2025-11-04

- Ops(Web): Next.js 웹앱 비컨테이너 전환 준비(standalone + systemd + Nginx)
  - Next 설정: `apps/web/next.config.js`에 `output: 'standalone'` 추가
  - 배포/롤백: `ops/web-deploy.sh`, `ops/web-rollback.sh` 추가 (릴리스 디렉터리/심볼릭 전환)
  - 운영 샘플: `ops/systemd/sogecon-web.service`, `ops/nginx/nginx-site-web.conf` 추가
  - 런타임 고정: 루트 `.tool-versions`에 `nodejs 22.17.1` 명시 (asdf)
  - 문서: `docs/agent_runbook_vps.md/_en.md`에 비컨테이너 런북 섹션 추가
  - 이슈: #46 수용기준 중 코드/스크립트/문서 초안 충족 (CI 아티팩트 업로드/연동은 후속)
- CI: `web-standalone-deploy` 워크플로 추가 — 빌드→아카이브→SCP→원격 `ops/web-deploy.sh` 실행
- CI: Semgrep(run-shell-injection) 경고 수정 — GitHub context는 run에서 직접 참조하지 않고 env로 주입하도록 변경
- 보안/운영 리뷰 반영
  - CI SSH 원격 단계 인자 주입 제거(stdin 전달 + TAR_NAME regex 검증, remote에서도 재검증)
  - deploy.sh: CI 시 REPO_ROOT 필수, sudoers 필요 주석 및 안내 추가
  - rollback.sh: current 심볼릭 경로 정규화(트레일링 슬래시 제거)
  - systemd 샘플: NEXT_PUBLIC_*는 빌드 타임 고정 주석 추가
  - nginx 샘플: CSP 예시 주석 및 중복 헤더 경고 추가
- CI: deploy.sh 호출 시 CI=1 전달
- deploy.sh: 오래된 릴리스 자동 정리(최근 5개 유지)
- rollback.sh: sudo -n 체크 및 안내 메시지 추가
- Dev: VPS 유사 로컬 스택 타깃 추가 — `make dev-api-up|down|logs|status` (postgres + postgres_test + api_dev)
- Docs(WSL2): dev-api-* 사용 예시로 갱신
- CI: web-standalone-deploy — setup-node의 pnpm 캐시 키 생성을 위해 pnpm/action-setup 선행 설치
- CI: web-standalone-bootstrap 추가 — VPS 1회 설정(Node 22.x, systemd 유닛, Nginx 사이트, sudoers)
- CI: bootstrap 개선 — 리포 자동 클론/갱신, git/nginx 설치 시도, 릴리스 경로 보장
- CI: build-push는 API만 빌드/푸시(SKIP_WEB=1); cloud-build.sh에 SKIP_API/SKIP_WEB 플래그 지원
- Ops: 웹 릴리스 기본 경로를 `/srv/www/sogecon`로 변경(`/opt/...`에서 전환); 유닛/워크플로/런북/README 반영

- Ops/Docs: 권한 복구 스크립트(`scripts/fix-web-perms.sh`)에 `uploads` 디렉터리 포함 — 컨테이너가 생성한 업로드 파일/폴더의 소유권을 사용자 계정으로 일괄 복구하도록 범위 확장
- Ops: 로컬 dev 프로필 compose 정리 및 재기동(포트 충돌 해소, 3000/3001/5433/5434 정상 동작 확인)
- Notes: 레포 내 root 소유물 스캔 후 전체 정리 완료
- Web(Home): Figma 디자인 기반 메인페이지 UI 구현
  - 히어로 캐러셀: 풀블리드 이미지 배경, 텍스트 오버레이, 그라디언트, 자동 슬라이드
  - 퀵 액션 타일: 6개 버튼 그리드, 브랜드 컬러, 커스텀 아이콘
  - 공지사항 리스트: 최근 5개, 날짜 포맷
  - 기존 섹션 제거 (하이라이트 카드, 회장 인사말, 스냅숏)
- Web(Home): 모바일 반응형 디자인 적용
  - 히어로 캐러셀: 모바일 193px, 태블릿 400px, 데스크톱 591px
  - 퀵 액션: 모바일 3열 그리드, 버튼 높이 107px
  - 공지사항: 제목 2줄 표시, 날짜 우측/상단 정렬
  - 인디케이터: 활성 타원형, 비활성 원형
- Web(Home): 퀵 액션 버튼 구성 변경 (Figma 디자인 반영)
  - 버튼 순서: 총동문회 소개 → 동문 수첩 → 행사 일정 → 총동문회 소식 → 자유게시판 → 경조사 게시판
  - 갤러리 제거, 가입인사 → 경조사 게시판 변경
  - 동문 소식 → 총동문회 소식 명칭 변경
  - 총동문회 소개 아이콘 추가 (홈/건물 아이콘)
- Web(Nav): 데스크톱 햄버거 메뉴 구현 (Figma 디자인 기반)
  - 데스크톱에서도 햄버거 아이콘 표시 (원형 버튼)
  - 우측에서 285px 사이드 패널 슬라이드
  - 메뉴 구조: 로그인 버튼 → 메뉴 섹션 (홈/게시판/행사 일정/동문 수첩) → 소개 섹션 (인사말/조직도/연혁) → 정보 섹션 (자주 묻는 질문/이용약관/개인정보처리방침)
  - 각 메뉴 항목에 아이콘 추가
  - Drawer 헤더에 로고와 닫기 버튼 표시
- Web(Home): 히어로 캐러셀 모바일 반응형 정밀 조정
  - 모바일 높이 193px → 218px (Figma 디자인 일치)
  - 모바일: 텍스트 중앙 정렬, 좌우 패딩 56px
  - 데스크톱/태블릿: 하단 좌측 정렬 유지
- Web(Nav): 모바일 메뉴 회원가입 버튼 추가 (Figma 디자인 반영)
  - 로그인 + 회원가입 버튼 나란히 배치 (동일한 너비)
  - 회원가입 버튼: 브랜드 컬러 테두리, 브랜드 컬러 텍스트, hover 효과
  - 사용자 추가 아이콘 포함
  - `/signup` 라우트로 연결 (타입 단언 처리)
- Web: 코드 리뷰 피드백 반영 (접근성, 안전성, 유지보수성 개선)
  - 날짜 포맷팅: `Intl.DateTimeFormat('ko-KR')` 사용, TZ 안전성 확보, NaN 처리
  - 접근성: 햄버거 버튼 `aria-haspopup="menu"` 추가, `aria-controls` 제거
  - 접근성: 캐러셀 인디케이터 표준 버튼 패턴으로 변경 (role="tablist"/role="tab" → aria-current)
  - Tailwind 테마: 브랜드 컬러 토큰화 (`bg-[#8a1e2d]` → `bg-brand-primary`, `action.discussion` 추가)
  - UX: `useQuery` 로딩/에러 상태 UI 추가 (스피너, 에러 메시지)
  - 코드 정리: 미사용 `trackRef` 제거
- Web(Nav): 모바일 메뉴 회원가입 → 계정 활성화로 변경
  - `/signup` → `/activate` 라우트 변경
  - 버튼 텍스트: "회원가입" → "계정 활성화"
  - 아이콘: 사용자 추가 → 잠금 아이콘으로 변경
  - 토큰 기반 계정 활성화 시스템에 맞게 조정
- Web: GitHub Copilot 코드 리뷰 피드백 반영
  - Docs: `worklog.md` 중복 2025-11-04 헤더 통합
  - 날짜 포맷: `formatToParts()` 사용으로 regex 대체 (명시적 파싱)
  - 스타일: `quick-actions.tsx`에서 `cn()` 유틸리티 사용으로 클래스 병합 개선
  - 텍스트 자르기: `hero-carousel`에서 `truncateAtWordBoundary()` 함수로 단어 경계 고려
  - 가독성: 캐러셀 반응형 포지셔닝에 설명 주석 추가 (모바일 중앙, 데스크톱 하단 좌측)
- Web: 날짜 포맷팅 버그 수정
  - `formatToParts()` 필터 로직 오류로 "20251104." 출력되던 문제 해결
  - literal 제외 후 점으로 join하여 "2025.11.04" 정상 출력

## Ops 변경(추가)

- 웹 릴리스 기본 경로 전환: `/opt/sogecon/web` → `/srv/www/sogecon`
  - systemd 유닛 WorkingDirectory 갱신(`ops/systemd/sogecon-web.service`)
  - deploy/rollback 기본 `RELEASE_BASE` 갱신(`ops/web-deploy.sh`, `ops/web-rollback.sh`)
  - bootstrap 워크플로우 디렉터리 생성/퍼미션 경로 갱신(`.github/workflows/web-standalone-bootstrap.yml`)
  - GitHub Actions 원격 배포 경로 갱신(`.github/workflows/web-standalone-deploy.yml`)
  - 런북/README 경로 안내 갱신
