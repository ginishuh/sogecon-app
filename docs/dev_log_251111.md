# 2025-11-11

- Build: Node.js 버전 22.19.0으로 상향
  - `apps/web/package.json` engines.node 필드 업데이트
  - `docs/versions.md` 동기화
  - `compose.yaml` web_dev 이미지 버전 업데이트 (node:22.17.1-slim → node:22.19.0-slim)
  - 로컬 환경과 컨테이너 환경 버전 일치화

- Web: 메인 페이지 및 메뉴 리디자인 (`feat/homepage-menu-redesign`)
  - 헤더 로고 변경: `sogang_korean_logo.svg` 제거, 텍스트 "서강대학교 경제대학원 총동문회"로 변경
  - 드로워 상단 로고를 `sogang.svg` 이미지로 교체 (하드코딩된 SVG 제거)
  - 햄버거 메뉴 구조 재설계:
    * 로그인 상태별 버튼 변경 (로그인/계정활성화 ↔ 내 정보/로그아웃)
    * 평면적 메뉴 구조 (섹션 구분 제거)
    * 하위 메뉴 펼침/접힘 기능 (총동문회 소개, 지원 정보, 관리자 메뉴)
    * 지원 정보에 "문의하기" 추가
  - 퀵 액션 타일: 기존 구성 유지 (총동문회 소개, 동문 수첩, 행사 일정, 총동문회 소식, 자유게시판, 경조사 게시판)
  - 공지사항 아래 "동문회장 인사말" 섹션 추가 (`HomeGreetingCard` 컴포넌트 생성)
  - ESLint complexity 이슈 해결: `DrawerMenu` 컴포넌트 분리로 `SiteHeader` 복잡도 감소 (11→10 이하)
  - FigmaHeader와 SiteHeader 메뉴 통합: `DrawerMenu` 컴포넌트를 단일 소스로 사용 (중복 제거)
  - 햄버거 메뉴 폰트 크기 조정: `text-base` → `text-sm` (14px)로 가독성 개선
  - Draft PR #50 생성 및 커밋

- Web/Docs: 기능 브랜치 `feat/homepage-figma-redesign` 공개 준비
  - 원격 동기화 점검: `origin/main` 대비 23 behind / 9 ahead 확인
  - 리베이스 시 다중 컨플릭트 발생(홈 컴포넌트 및 worklog) → PR에서 처리하기로 결정
  - 브랜치 원격 업로드 및 PR 생성 준비(드래프트)

- Web: `origin/main` 기준 리베이스 완료 및 컨플릭트 해결
  - hero-carousel/quick-actions/notice-list/site-header 충돌 수동 머지
  - 접근성/토큰화/날짜 포맷 로직 유지(aria-current, Tailwind 토큰, formatToParts)
  - docs: dev_log_251104.md, worklog.md 충돌 정리
  - 코드 리뷰 반영: hero-carousel 내부 로딩 오버레이(unreachable code) 제거, `HeroSkeleton`만 사용
  
- Infra/API: 버전 락 체크 통과
  - `apps/api/requirements.txt`의 `fastapi`를 `0.118.0`으로 고정 (SSOT: docs/versions.md)
  - `starlette`를 `0.49.1`로 고정해 pip-audit 취약점(GHSA-7f5h-v6xp-fcq8) 해결
  - 이후 종속성 충돌(verify-dto) 해결을 위해 `fastapi`를 `0.120.1`로 상향하고 `starlette` 핀 제거
  - `ops/ci/check_versions.py`, `docs/versions.md` 동기화

- Build: Node.js 버전 22.21.1로 재업데이트
  - `apps/web/package.json` engines.node: 22.19.0 → 22.21.1
  - `compose.yaml` web_dev 이미지: node:22.19.0-slim → node:22.21.1-slim
  - `docs/versions.md` 문서화

- Web/API: 게시판 기능 대폭 개선
  - 게시판 UI를 네이버 카페 스타일 테이블로 리디자인
    * 번호, 분류, 제목, 작성자, 날짜 컬럼 구성
    * 고정 게시글 노란색 배경(bg-yellow-50) 및 "공지" 표시
    * 테이블 헤더 회색 배경(bg-slate-100), 타이트한 보더
  - Next.js App Router 호환성 수정
    * PostCard href 타입을 string으로 단순화
    * 템플릿 리터럴로 동적 경로 처리: `href={`/board/${post.id}`}`
  - Docker 환경 SSR API 연결 수정
    * api.ts에서 서버 사이드 렌더링 시 Docker 환경 감지
    * localhost 대신 컨테이너 서비스명(api_dev:3001) 사용
  - 게시글 상세 페이지 디자인 개선
    * 네이버 카페 스타일 카드 레이아웃
    * 헤더/본문/하단 버튼 영역 명확한 구분
    * 카테고리 배지 및 고정 핀 표시

- API/Web: 댓글 기능 전면 구현
  - 백엔드 구현
    * Comment 모델 추가 (post_id, author_id, content, created_at)
    * CommentCreate, CommentRead 스키마 추가
    * comments 리포지토리, 서비스, 라우터 추가
    * Alembic 마이그레이션 생성: 76f24ccecb58_add_comments_table.py
  - 프론트엔드 구현
    * comments 서비스 추가 (listComments, createComment, deleteComment)
    * CommentsSection 컴포넌트 생성 (React Query 기반)
    * 댓글 목록 조회, 작성, 삭제 기능
    * 낙관적 업데이트 및 에러 핸들링
  - 권한 제어
    * 댓글 작성: 관리자 또는 회원만 가능
    * 댓글 삭제: 본인 또는 관리자만 가능
    * 관리자는 author_id를 명시적으로 지정 가능

- Refactor: 하드코딩된 "회원{id}" 제거 및 실제 작성자 이름 표시
  - 백엔드 수정
    * PostRead, CommentRead 스키마에 author_name 필드 추가
    * posts, comments 리포지토리에서 joinedload로 author 관계 조인
    * 라우터에서 조인된 author.name을 author_name에 설정
  - 프론트엔드 수정
    * Post, Comment 타입에 author_name 필드 추가
    * UI에서 author_name 우선 표시, fallback으로 "회원{id}"
    * 게시판 목록, 상세 페이지, 댓글 섹션 모두 적용

- Code Quality: Ruff 및 ESLint 위반 수정
  - Python 라인 길이 제한(88자) 준수
    * models.py, repositories/posts.py, services/comments_service.py 수정
  - ESLint no-floating-promises 수정
    * CommentsSection에서 invalidateQueries를 void로 명시적 마킹

- Web(코드리뷰 반영): 타입/동작 정리
  - API 204 응답 처리에서 double-cast 제거(`parseOk: Promise<T|void>`)
  - Drawer 로그아웃 버튼이 `logoutAll()`을 호출하도록 연결 후 로그인 화면으로 복귀
  - 테스트: middleware 테스트의 임시 캐스트 제거, NextResponse/NextRequest 인스턴스 사용

- Refactor: 코드 리뷰 반영 - 이중 캐스트 제거 및 예외 처리 개선
  - Web: apiFetch 이중 캐스트 제거
    * apps/web/lib/api.ts: 오버로드 추가 (DELETE는 void, 나머지는 T)
    * parseOk에서 204는 return만으로 종료 (캐스트 불필요)
    * apps/web/services/comments.ts: deleteComment 제네릭 제거
  - API: 댓글 라우터 예외 처리 개선
    * apps/api/routers/comments.py: HTTPStatus.UNAUTHORIZED만 폴백
    * posts.py 패턴과 일관성 확보 (401 외 예외는 즉시 raise)

- Build: CI 워크플로우 Node.js 버전 동기화
  - CI 실패 수정: repo-guards, verify-dto, e2e (Node.js 버전 불일치)
  - ops/ci/check_versions.py: expected_engines를 22.21.1로 업데이트
  - .github/workflows 업데이트: dto-verify.yml, e2e.yml, ci.yml
  - 모든 CI 워크플로우에서 node-version: 22.21.1 사용

- Fix: CI 실패 수정 (bandit B101, ruff B904, TypeScript 타입 에러)
  - apps/api/routers/comments.py: assert 제거하고 명시적 None 체크로 변경
    * bandit B101 해결: assert는 최적화 컴파일 시 제거되므로 프로덕션 코드에서 사용 금지
    * ruff B904 해결: except 블록에서 raise 시 `from None`으로 예외 체인 명확화
  - apps/web/components/drawer-menu.tsx: DrawerMenu status 타입에 loading 추가
    * figma-header.tsx에서 useAuth()가 반환하는 loading 상태 처리
    * status !== 'authorized' 조건으로 loading과 unauthorized를 동일하게 처리
  - apps/web/components/post-card.tsx: PostCard href 타입을 Route로 변경
    * Next.js Link 컴포넌트가 요구하는 Route 타입과 일치하도록 수정
    * web, e2e, verify-dto CI 빌드 에러 해결
  - apps/web/services/notifications.ts: deleteSubscription DELETE 오버로드 제네릭 제거
    * apiFetch DELETE 오버로드는 자동으로 void 반환하므로 제네릭 불필요
    * 타입 에러 해결: Type '"DELETE"' is not assignable to type '"GET" | "POST" | "PUT" | "PATCH"'

- Perf: 번들 크기 최적화 (1005KB → 1000KB 이하 목표)
  - CommentsSection 컴포넌트를 동적 import로 변경
    * apps/web/app/board/[id]/page.tsx에서 next/dynamic 사용
    * React Query 포함한 댓글 기능을 초기 번들에서 제외
    * 게시글 상세 페이지에서만 필요하므로 지연 로딩
    * ssr: false 옵션 제거: Server Component에서는 사용 불가, 이미 'use client'이므로 불필요
  - DrawerMenu 컴포넌트를 동적 import로 변경
    * apps/web/components/site-header.tsx, figma-header.tsx에서 동적 로드
    * 햄버거 메뉴 클릭 시에만 로드되도록 최적화
    * 초기 페이지 로드 성능 개선
